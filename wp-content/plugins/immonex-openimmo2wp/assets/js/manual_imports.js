"use strict";(self.webpackChunk_immonex_openimmo2wp=self.webpackChunk_immonex_openimmo2wp||[]).push([[186],{212:(e,t,r)=>{function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function i(e,t){if(e){if("string"==typeof e)return n(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}function a(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||i(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,a,o,s=[],l=!0,c=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=a.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(e){c=!0,i=e}finally{try{if(!l&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}(e,t)||i(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return l(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}r.r(t),r.d(t,{init:()=>j,performImport:()=>N});var c,u=!0,d="",f=!1,m=!1,p=!1,v=0,g=[],y=0;function h(e,t){var r=document.createTextNode(t.file),n=document.createTextNode(t.procOrder),i={},a=document.createElement("li");a.setAttribute("name",t.file);for(var o=0,s=["bullet-spinner-wrap","proc-bullet","proc-spinner","info-wrap","proc-order","proc-filename"];o<s.length;o++){var l=s[o];i[l]=document.createElement("div"),i[l].classList.add(l)}if("undefined"!=typeof immonex_oi2wp_manual_import){var c=document.createElement("img");c.setAttribute("src",immonex_oi2wp_manual_import.spinner_image_url),c.setAttribute("alt","Spinner Animation"),i["proc-spinner"].appendChild(c)}i["bullet-spinner-wrap"].appendChild(i["proc-bullet"]),i["bullet-spinner-wrap"].appendChild(i["proc-spinner"]),i["proc-order"].appendChild(n),i["proc-filename"].appendChild(r),i["info-wrap"].appendChild(i["proc-order"]),i["info-wrap"].appendChild(i["proc-filename"]),a.appendChild(i["bullet-spinner-wrap"]),a.appendChild(i["info-wrap"]),e.appendChild(a)}function b(e){e="is-"+e;var t,r=s(document.getElementsByClassName("import-folder-list"));try{for(r.s();!(t=r.n()).done;){var n=t.value,i=n.getElementsByClassName(e);if(i.length>0)return{file:i[0].getAttribute("name"),fileNode:i[0],folder:n.getAttribute("name"),listNode:n,infoNode:i[0].getElementsByClassName("info-wrap")[0]}}}catch(e){r.e(e)}finally{r.f()}return!1}function _(e){if(Array.isArray(e)||(e=[e]),!(e.length>0&&JSON.stringify(e)===JSON.stringify(g))){g=e;var t,r=document.getElementsByClassName("import-folder-list"),n=e&&e.length>0?function(e){var t,r={},n=s(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.folder&&(r[i.folder]||(r[i.folder]=[]),r[i.folder].push(i))}}catch(e){n.e(e)}finally{n.f()}return r}(e):{},i=s(r);try{var l=function(){var r,i=t.value,o=i.getAttribute("name"),l=s(i.getElementsByTagName("li"));try{var c=function(){var t,i=r.value;if(!i.getAttribute("name"))return 0;var s,l,c,u=i.getElementsByClassName("proc-filename");if(!u.length)return 0;(t=i.classList).remove.apply(t,a(i.classList)),u[0].classList.remove("dashicons-before","dashicons-yes-alt"),n[o]&&n[o].find(function(e){return e.file===i.getAttribute("name")})?(n[o]=n[o].filter(function(e){return e.file!==i.getAttribute("name")}),s=i,l=e.findIndex(function(e){return e.file===i.getAttribute("name")})+1,(c=s.getElementsByClassName("proc-order")).length&&(c[0].innerHTML=l)):(i.classList.add("is-complete"),u[0].classList.add("dashicons-before","dashicons-yes-alt"))};for(l.s();!(r=l.n()).done;)c()}catch(e){l.e(e)}finally{l.f()}if(n[o]){var u,d=s(n[o]);try{var f=function(){var t=u.value;t.procOrder=e.findIndex(function(e){return e.folder===o&&e.file===t.file})+1,h(i,t)};for(d.s();!(u=d.n()).done;)f()}catch(e){d.e(e)}finally{d.f()}delete n[o]}};for(i.s();!(t=i.n()).done;)l()}catch(e){i.e(e)}finally{i.f()}for(var c=function(){var t=o(d[u],2),n=t[0],i=t[1];if(0===i.length)return 1;var a=r.namedItem(n);if(a||"global"===n||(a=function(e){var t=document.getElementById("user-import-folder-file-lists");if(t){var r=document.createTextNode(e.split("/").slice(-1)),n=document.createElement("code");n.appendChild(r);var i=document.createElement("div");i.classList.add("import-folder","dashicons-before","dashicons-admin-users"),i.appendChild(n);var a=document.createElement("ul");return a.setAttribute("name",e),a.classList.add("import-folder-list"),t.appendChild(i),t.appendChild(a),t.classList.contains("no-user-import-folders")&&t.classList.remove("no-user-import-folders"),a}}(n)),a){var l,c=s(i);try{var f=function(){var t=l.value;t.procOrder=e.findIndex(function(e){return e.folder===n&&e.file===t.file})+1,h(a,t)};for(c.s();!(l=c.n()).done;)f()}catch(e){c.e(e)}finally{c.f()}}},u=0,d=Object.entries(n);u<d.length;u++)c();var f=b("processing"),m=e.find(function(e){return e.processing});if(m&&(!f||f.folder!==m.folder||f.file!==m.file))return L(),E(m.folder,m.file,"current"),void A(m.folder,m.file);var p=e.length>0&&e[0];p&&E(p.folder,p.file,"current")}}function A(e,t){var r=document.getElementById("file-process-status-wrap"),n=E(e,t,"processing");r&&n&&n.getElementsByClassName("info-wrap")[0].appendChild(r)}function E(e,t,r){var n=!1;"-"===r.charAt(0)&&(r=r.substr(1),n=!0),r="is-"+r;var i,a=document.getElementsByClassName("import-folder-list"),o=s(a);try{for(o.s();!(i=o.n()).done;){var l,c=s(i.value.getElementsByClassName(r));try{for(c.s();!(l=c.n()).done;){l.value.classList.remove(r)}}catch(e){c.e(e)}finally{c.f()}}}catch(e){o.e(e)}finally{o.f()}if(!n){var u=a.namedItem(e);if(!u)return!1;var d=u.getElementsByTagName("li").namedItem(t);return!!d&&(d.classList.add(r),d)}}function w(e,t){var r=document.getElementById("process-control-button");r&&(e.length>0&&r.innerText!==e&&(r.innerText=e),t&&r.hasAttribute("disabled")&&r.removeAttribute("disabled"),t||r.hasAttribute("disabled")||r.setAttribute("disabled","disabled"))}function L(){var e=document.getElementById("process-progress"),t=document.getElementById("process-current-property"),r=document.getElementById("process-current-attachment");e&&e.setAttribute("value",0),t&&(t.innerHTML=""),r&&(r.innerHTML="")}function x(e){var t,r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=document.getElementById("overall-process-result");if(i){n||(n="notice");var o=[];e&&o.push("immonex-plugin-options__infobox","immonex-plugin-options__infobox--is-"+n);var s=o.join(" ")!==i.className,l=e;if(Array.isArray(e)){var c=e.length>1?"<ul><li>"+e.slice(1).join("</li><li>")+"</li></ul>":"";l="<p><strong>".concat(e[0],"</strong></p>\n").concat(c)}(s||i.innerHTML.trim()!==l)&&((t=i.classList).remove.apply(t,a(i.classList)),(r=i.classList).add.apply(r,o),i.innerHTML=l)}}function I(e){var t=immonex_oi2wp_manual_import.dialog_texts;switch(e.status){case"processing":var r=document.getElementById("process-scope"),n=document.getElementById("process-current-property"),i=document.getElementById("process-current-attachment"),a=document.getElementById("process-progress");if(a&&e.total_cnt_properties>0&&e.cnt_next_property>0){var o=Math.ceil(100*e.cnt_next_property/e.total_cnt_properties);a.setAttribute("value",o)}if(r&&e.import_type){var s="full"===e.import_type?t.full_import:t.partial_import;e.file_mtime&&(s+=" (".concat(e.file_mtime,")")),r.innerHTML=s}n&&(n.innerHTML=e.current_property?(e.current_property.match(/^[1-9].*/)?t.property:"")+" "+e.current_property:""),i&&(i.innerHTML=e.current_attachment&&"-"!==e.current_attachment?t.attachment+" "+e.current_attachment:""),w(t[e.token?"import_running":"resume_import"],!e.token),x("* "+t.resume_info,"notice");break;case"killswitch":w(t.import_stopped,!1);break;case"inactive":p||x(0===e.pending.length?t.no_pending_files_info:""),f||w(t.start_import,e.pending.length>0);break;case"completed":x(t.success_message,"success"),f||w(t.start_import,e.pending.length>0);break;case"error":var l=b("processing");l&&E(l.folder,l.file,"-processing"),L()}if(void 0!==e.pending){_(e.pending);var c=document.getElementById("immonex-manual-import-and-folders");e.pending.length>0&&c.classList.contains("no-pending-files")&&c.classList.remove("no-pending-files")}}function C(e){var t=e.match(/{.*}/),r=e.replace(t,"").trim();try{var n=JSON.parse(t)}catch(e){return!1}return{data:n,debug:r}}function B(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];jQuery.ajax({url:"admin-ajax.php",type:"POST",async:!0,cache:!1,timeout:3e4,data:{action:"get_current_import_status"},success:function(t){var r=C(t);r&&r.data&&("processing"===r.data.status?(f=!0,r.data.token&&(d=r.data.token)):m||(f=!1),e&&(g=r.data.pending),I(r.data))}})}function T(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=document.getElementById("import-ajax-debug");if(t){var r=t.getElementsByClassName("debug-contents")[0];r&&(e?r.innerHTML.includes(e)||(r.innerHTML+=e.replace(/\n/g,"<br>\n")+"<br>\n"):r.innerHTML="",!e&&t.classList.contains("has-output")?t.classList.remove("has-output"):e&&!t.classList.contains("has-output")&&t.classList.add("has-output"))}}function N(){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=immonex_oi2wp_manual_import.dialog_texts;if(u){var r=b("current");if(!r)return;A(r.folder,r.file),p=!0,m=!0,f=!0,w(t.import_running,!1),x("* "+t.resume_info,"notice"),T(),u=!1}jQuery.ajax({url:"admin-ajax.php",type:"POST",async:!0,cache:!1,timeout:3e5,data:{token:d,action:"perform_import",force_resumption:e?2:0},success:function(e){var r=C(e);if(r&&r.data.token&&(d=r.data.token),r&&r.debug&&T(r.debug),r&&"processing"===r.data.status)return I(r.data),void N();if(r&&"completed"===r.data.status)return f=!1,u=!0,d="",L(),I(r.data),void x(t.success_message,"success");if(r&&"error"===r.data.status){if(1===r.data.import_process_already_running)return void(confirm(t.resumption_prompt)&&N(null,!0));x([t.error_message].concat(r.data.messages),"error")}else S(t.fatal_error_invalid_status);f=!1,r&&I(r.data)},complete:function(e,r){if(m=!1,"success"!==r){if(!e.getAllResponseHeaders())return;if(d&&500===e.status){if(++y<=3)return void setTimeout(function(){N()},5e3);f=!1;var n=t.server_error;"timeout"===r&&(n+=" (Timeout)"),S(n)}}}})}function S(e){window.clearInterval(c),w(immonex_oi2wp_manual_import.dialog_texts.import_aborted,!1),x(e,"error");var t=b("processing");t&&(E(t.folder,t.file,"-processing"),E(t.folder,t.file,"error"))}function j(){var e=document.getElementById("process-control-button");e&&(e.addEventListener("click",N),B(!0),c=window.setInterval(function(){++v>1024&&(v=0),v%(f?2:5)||B()},1e3))}}}]);