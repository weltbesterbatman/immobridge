# ImmoBridge WordPress Plugin - Cursor Rules

## ProjektÃ¼bersicht

- **Plugin-Name:** ImmoBridge
- **Zweck:** Modernes WordPress-Plugin zum Import von Immobiliendaten im OpenImmo-Format aus Maklersoftware (z.B. Propstack) mit exklusiver Bricks Builder Integration
- **GitHub:** https://github.com/weltbesterbatman/immobridge
- **Lokale Umgebung:** MAMP Pro 6.8.1 (PHP 8.2, MySQL 5.7.39, WordPress 6.9)
- **Lokale URL:** https://immonex-bricks-wp.local:8890/

## Wichtige Verzeichnisse

```
Projekt-Root/
â”œâ”€â”€ wp-content/plugins/immobridge/          # Aktive Entwicklung
â”œâ”€â”€ wp-content/plugins/immonex-openimmo2wp/ # Legacy-Referenz (nicht bearbeiten)
â”œâ”€â”€ _project-planung/                       # Dokumentation & Architektur
â”‚   â”œâ”€â”€ 00_Projektkontext.md               # Projektziele & Technologien
â”‚   â”œâ”€â”€ 01_Architekturdokumentation.md     # Legacy-Analyse
â”‚   â”œâ”€â”€ 03_Technische_Spezifikation_ImmoBridge.md  # Haupt-Spezifikation
â”‚   â”œâ”€â”€ 06_Projekt_Regeln.md               # Coding-Standards
â”‚   â”œâ”€â”€ 07_Projekt_Roadmap.md              # Aktueller Status & Roadmap
â”‚   â””â”€â”€ example/openimmo-version_127c/     # OpenImmo XSD Schema
â””â”€â”€ __old/                                  # Archivierte/veraltete Dateien
```

## Aktueller Entwicklungsstand (Stand: 14. Januar 2026)

| Phase | Status | Beschreibung |
|-------|--------|--------------|
| Phase 1: Grundarchitektur | âœ… Abgeschlossen | PSR-4, DI-Container, CPT, Taxonomien |
| Phase 2: OpenImmo Integration | âœ… Abgeschlossen | XML-Import funktional, 38 Properties importiert |
| Phase 3: Bricks Builder | ðŸŸ¡ In Arbeit | Dynamic Data Tags registriert, Templates erstellt, **Template-Zuweisung & Wertzuweisung XMLâ†’CustomField offen** |
| Phase 4: API & Extensions | ðŸ“‹ Geplant | REST API, Webhooks |
| Phase 5: Testing & Optimization | ðŸ“‹ Geplant | PHPUnit, Performance, Security |

## NÃ¤chste priorisierte Aufgaben

1. **[Phase 3 - Kritisch]** Template-Zuweisung validieren und korrigieren (Titel-Links in Listenansicht, Bildergalerie in Detailansicht)
2. **[Phase 3 - Kritisch]** XML â†’ Custom Field Wertzuweisung im `OpenImmoImporter.php` finalisieren
3. **[Phase 3 - Kritisch]** Bricks Dynamic Data Tags mit echten importierten Daten testen
4. **[Phase 3]** Git Commit fÃ¼r Phase 3 Abschluss
5. **[Phase 5]** Unit-Tests fÃ¼r `MappingService` und `OpenImmoImporter` schreiben
6. **[Phase 4]** REST API Endpoints fÃ¼r Properties implementieren

## Wichtige Code-Dateien

| Datei | Zweck |
|-------|-------|
| `src/Core/Plugin.php` | Hauptklasse, Service Provider Orchestrierung |
| `src/Services/OpenImmoImporter.php` | OpenImmo XML Import (Batch-fÃ¤hig) |
| `src/Services/MappingService.php` | CSV-Mapping-Logik |
| `src/Integrations/Bricks/DynamicDataProvider.php` | Bricks Dynamic Data Tags |
| `src/Repositories/PropertyRepository.php` | Datenbankzugriff (Repository Pattern) |
| `mappings/bricks-default.csv` | Feld-Mapping OpenImmo â†’ WordPress |

## Technische Standards (WICHTIG!)

### PHP & Coding
- **PHP-Version:** 8.2+ (strikte Typisierung nutzen)
- **Jede PHP-Datei beginnt mit:** `declare(strict_types=1);`
- **Namespace:** `ImmoBridge\...` (PSR-4)
- **Coding Style:** PSR-12 + WordPress Coding Standards
- **Dependency Injection:** Keine direkte Instanziierung (`new Service()`), immer Ã¼ber Container

### Architektur-Regeln
- **Repository Pattern:** Kein direkter `WP_Query` oder `$wpdb` in GeschÃ¤ftslogik
- **Service Provider:** Neue Services Ã¼ber ServiceProvider registrieren
- **Interfaces:** Suffix `Interface` (z.B. `PropertyRepositoryInterface`)
- **Traits:** Suffix `Trait` (z.B. `CacheableTrait`)

### Sprache
- **Gesamtes Projekt:** Deutsch
- **Code-Kommentare:** Deutsch
- **Commit-Messages:** Deutsch, Conventional Commits (`feat:`, `fix:`, `docs:`)
- **Dokumentation:** Deutsch

## WordPress Backend Zugang

- **URL:** https://immonex-bricks-wp.local:8890/wp-admin/
- **Benutzer:** admin
- **Passwort:** Admin-123456

## Datenbank

- **Host:** localhost:8889
- **Datenbank:** wp_immonexbrickswplocal_db
- **Benutzer:** wp_immonexbrickswplocal_user
- **Passwort:** wp_immonexbrickswplocal_pw
- **phpMyAdmin:** http://localhost:8888/phpMyAdmin5/

## OpenImmo-Standard

- **UnterstÃ¼tzte Version:** 1.2.7c
- **Schema-Datei:** `_project-planung/example/openimmo-version_127c/openimmo_127c.xsd`
- **Beispiel-XML:** `_project-planung/example/einzelobjekt-beispiel.xml`

## Workflow nach Ã„nderungen

1. âœ… Code-Ã„nderungen testen
2. âœ… `_project-planung/07_Projekt_Roadmap.md` aktualisieren (Version + Datum)
3. âœ… Git Commit mit Conventional Commits
4. âœ… Bei Milestone: Push zu GitHub

## Bekannte offene Probleme

1. **Template-Zuweisung:** Titel-Links in Listenansicht funktionieren nicht, Bildergalerie in Detailansicht funktioniert nicht - Template-Zuweisung muss validiert werden (verwendetes Template vs. erstelltes Template)
2. **Wertzuweisung nicht vollstÃ¤ndig:** `MappingService.getElementValue()` liefert Werte, aber die Zuweisung zu Custom Fields im `OpenImmoImporter` muss fÃ¼r alle Feldtypen validiert werden
3. **Keine Unit-Tests:** Test-Infrastruktur vorhanden, aber keine Tests geschrieben
4. **Logging unstrukturiert:** `error_log()` statt Monolog (Monolog ist installiert)

## Letzte Ã„nderungen (14.01.2026)

- âœ… Template-Verbesserungen: Meta-Informationen hinzugefÃ¼gt, Links korrigiert, Post-Type korrigiert
- âœ… Code-Bereinigung: Cleanup-Funktion entfernt, deutsche Ãœbersetzungen implementiert
- âœ… Git Commit & Push: Erfolgreich zu GitHub gepusht (Commit `7c7908b`, `a1fd14d`)

## Referenz-Dokumente

Bei komplexen Fragen diese Dokumente konsultieren:
- Architektur: `_project-planung/03_Technische_Spezifikation_ImmoBridge.md`
- Projekt-Regeln: `_project-planung/06_Projekt_Regeln.md`
- Roadmap: `_project-planung/07_Projekt_Roadmap.md`
- Legacy-Analyse: `_project-planung/01_Architekturdokumentation.md`
